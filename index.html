<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquivos Log√≠sticos</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header class="app-header">
        <div class="header-content">
            <div class="header-info">
                <h1>Arquivos Log√≠sticos</h1>
                <p>Ferramentas para NFe, ZPL e PROCEDA</p>
            </div>
            
            <nav class="tab-navigation">
                <button class="tab-button active" data-tab="zpl-viewer">üìÑ Visualizador ZPL</button>
                <button class="tab-button" data-tab="nfe-zpl">üì¶ Gerar ZPL</button>
                <button class="tab-button" data-tab="reports-advanced">üìä Relat√≥rios de Notas fiscais</button>
                <button class="tab-button" data-tab="barcode-generator">Gerador de C√≥digo Barras</button>
                <button class="tab-button" data-tab="proceda">üîß PROCEDA</button>
                <button class="tab-button" data-tab="nfe-batch-validator">üìë Validador de Chave Nfe (Lote)</button>
            </nav>
        </div>
    </header>

    <main class="app-container">
   
    
    <script src="main.js"></script>
        <section id="zpl-viewer" class="tab-content active">
            <div class="zpl-viewer-layout">
                <div class="editor-column">
                    <h2>Editor ZPL</h2>
                    <textarea 
                        id="zpl-input" 
                        placeholder="Cole o seu c√≥digo ZPL aqui...&#10;&#10;Exemplo:&#10;^XA&#10;^FO50,50^A0N,50,50^FDHello World!^FS&#10;^XZ"
                    ></textarea>
                    <button id="render-button" class="button-primary">üöÄ Atualizar Pr√©-visualiza√ß√£o</button>
                </div>
                <div class="viewer-column">
                    <h2>Pr√©-visualiza√ß√£o</h2>
                    <div class="image-container">
                        <img 
                            id="label-image" 
                            src="https://via.placeholder.com/400x600/f3f4f6/6b7280?text=Etiqueta+Aparece+Aqui" 
                            alt="Pr√©-visualiza√ß√£o da etiqueta"
                        >
                    </div>
                </div>
            </div>
        </section>

        <section id="nfe-zpl" class="tab-content">
            <h2 style="margin-bottom: 2rem; font-size: 2rem;">Gerar Etiqueta ZPL a partir de XML (NFe)</h2>
            <div class="tool-card">
                <h3>1. Carregar Ficheiro XML</h3>
                <p style="color: var(--color-text-muted); margin-bottom: 1rem;">Selecione o arquivo XML da Nota Fiscal Eletr√¥nica.</p>
                <input type="file" id="xml-input" class="input-file" accept=".xml">
            </div>
            <div class="tool-card">
                <h3>2. C√≥digo ZPL Gerado</h3>
                <p style="color: var(--color-text-muted); margin-bottom: 1rem;">O c√≥digo ZPL da etiqueta simplificada aparecer√° abaixo.</p>
                <textarea id="nfe-zpl-output" readonly placeholder="Aguardando carregamento do XML..."></textarea>
                <div class="button-group">
                    <button id="copy-zpl-button" class="button-secondary">üìã Copiar ZPL</button>
                    <button id="send-to-viewer-button" class="button-primary">üëÅÔ∏è Ver no Visualizador</button>
                </div>
            </div>
        </section>

       <section id="reports-advanced" class="tab-content">
            <h2 style="margin-bottom: 2rem; font-size: 2rem;">Relat√≥rios de NFe/CTe</h2>
            
            <div class="zpl-viewer-layout"> <div class="editor-column">
                    <h3>üì• Origem dos Dados</h3>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="font-weight: 600; display: block; margin-bottom: 0.5rem;">Op√ß√£o A: Colar Chaves de Acesso</label>
                        <textarea id="report-text-input" placeholder="Cole uma chave por linha aqui..." style="min-height: 150px;"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="font-weight: 600; display: block; margin-bottom: 0.5rem;">Op√ß√£o B: Carregar Ficheiros XML</label>
                        <input type="file" id="report-xml-input" class="input-file" multiple accept=".xml">
                        <p style="font-size: 0.85rem; color: var(--color-text-muted); margin-top: 0.5rem;">
                            Pode selecionar m√∫ltiplos ficheiros de uma s√≥ vez.
                        </p>
                    </div>

                    <button id="report-process-button" class="button-primary" style="width: 100%;">üöÄ Processar Tudo</button>
                </div>

                <div class="viewer-column">
                     <h3>üìà Resumo do Processamento</h3>
                     <div id="report-summary" style="display: none; text-align: center; padding-top: 2rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                             <div style="padding: 1rem; background: var(--color-success-bg); border-radius: 8px; color: #065f46;">
                                 <div style="font-size: 0.9rem;">V√°lidos</div>
                                 <div id="summary-valid" style="font-size: 2.5rem; font-weight: 700;">0</div>
                             </div>
                             <div style="padding: 1rem; background: var(--color-error-bg); border-radius: 8px; color: #991b1b;">
                                 <div style="font-size: 0.9rem;">Inv√°lidos/Erro</div>
                                 <div id="summary-invalid" style="font-size: 2.5rem; font-weight: 700;">0</div>
                             </div>
                        </div>
                        <div style="padding: 1rem; background: var(--color-bg-secondary); border-radius: 8px;">
                            <div style="font-size: 0.9rem; color: var(--color-text-muted);">Valor Total Identificado</div>
                            <div id="summary-total-value" style="font-size: 1.8rem; font-weight: 600; color: var(--color-primary);">R$ 0,00</div>
                        </div>
                     </div>
                     <div id="report-loading" style="display: none; text-align: center; padding: 3rem; color: var(--color-text-muted);">
                        ‚è≥ Processando ficheiros...
                     </div>
                </div>
            </div>

            <div class="tool-card" id="report-results-container" style="display: none; margin-top: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>üìä Detalhamento dos Registros</h3>
                    <div class="button-group" style="margin: 0;">
                         <button id="report-clear-button" class="button-secondary">üóëÔ∏è Limpar</button>
                         <button id="report-export-csv" class="button-secondary">üì• Exportar CSV</button>
                    </div>
                </div>
                <div style="overflow-x: auto; max-height: 500px; overflow-y: auto;">
                    <table class="proceda-table" id="report-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Origem</th>
                                <th>Chave de Acesso</th>
                                <th>Data Emiss√£o</th>
                                <th>Emitente</th>
                                <th>Destinat√°rio</th>
                                <th>Valor Total</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

            <div id="batch-results" style="display: none;">
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div class="tool-card" style="text-align: center; padding: 1.5rem;">
                        <h3 style="justify-content: center; margin:0;">Total</h3>
                        <p id="batch-total" style="font-size: 2.5rem; font-weight: 700; color: var(--color-primary);">0</p>
                    </div>
                    <div class="tool-card" style="text-align: center; padding: 1.5rem; background: var(--color-success-bg); border-color: var(--color-success);">
                        <h3 style="justify-content: center; margin:0; color: #065f46;">V√°lidas</h3>
                        <p id="batch-valid" style="font-size: 2.5rem; font-weight: 700; color: #059669;">0</p>
                    </div>
                    <div class="tool-card" style="text-align: center; padding: 1.5rem; background: var(--color-error-bg); border-color: var(--color-error);">
                        <h3 style="justify-content: center; margin:0; color: #991b1b;">Inv√°lidas</h3>
                        <p id="batch-invalid" style="font-size: 2.5rem; font-weight: 700; color: #dc2626;">0</p>
                    </div>
                </div>

                <div class="tool-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>üìä Detalhamento</h3>
                        <button id="batch-export-csv" class="button-secondary">üì• Exportar CSV</button>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="proceda-table" id="batch-table">
                            <thead>
                                <tr>
                                    <th>Status</th>
                                    <th>Chave de Acesso</th>
                                    <th>Modelo</th>
                                    <th>S√©rie</th>
                                    <th>N√∫mero</th>
                                    <th>Data (AA/MM)</th>
                                    <th>UF</th>
                                    <th>CNPJ Emitente</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
        <section id="barcode-generator" class="tab-content">
            <h2 style="margin-bottom: 2rem; font-size: 2rem;">Gerador de C√≥digo de Barras</h2>
            <div class="tool-card">
                <div class="form-group">
                    <label for="barcode-data">üìä Dados para o C√≥digo:</label>
                    <input type="text" id="barcode-data" placeholder="Ex: 1234567890123">
                </div>
                
                <div class="form-group">
                    <label for="barcode-format">üìê Formato do C√≥digo:</label>
                    <select id="barcode-format">
                        <option value="CODE128" selected>Code 128 (Padr√£o - Alfanum√©rico)</option>
                        <option value="EAN13">EAN-13 (13 d√≠gitos - Varejo)</option>
                        <option value="EAN8">EAN-8 (8 d√≠gitos - Pequeno)</option>
                        <option value="UPC">UPC (12 d√≠gitos - EUA/Canad√°)</option>
                        <option value="CODE39">Code 39 (Alfanum√©rico Legacy)</option>
                    </select>
                </div>
                
                <button id="barcode-generate-button" class="button-primary">üé® Gerar C√≥digo</button>
                
                <div class="barcode-container">
                    <svg id="barcode-output"></svg>
                </div>
            </div>
        </section>

        <section id="proceda" class="tab-content">
            <h2 style="margin-bottom: 2rem; font-size: 2rem;">Validador de Arquivos EDI Log√≠sticos</h2>
            
            <div class="tool-card">
                <h3>üìÅ Carregar Arquivo EDI</h3>
                <p style="color: var(--color-text-muted); margin-bottom: 1rem;">
                    <strong>Suporta modelos:</strong><br>
                    ‚Ä¢ <strong>NOTFIS 5.0</strong> <br>
                    ‚Ä¢ <strong>NOTFIS 3.1</strong> <br>
                    ‚Ä¢ <strong>OCOREN 5.0</strong> <br>
                    ‚Ä¢ <strong>OCOREN 3.1</strong> <br>                    
                </p>
                <input type="file" id="proceda-input" class="input-file" accept=".txt,.edi,.proceda,.notfis,.ocoren">
                
                <div style="margin-top: 1rem;">
                    <button id="open-edi-settings-modal" class="button-secondary">‚öôÔ∏è Configurar Layouts</button>
                </div>
            </div>
            
            <div class="tool-card" id="proceda-tables" style="display: none;">
                <h3>üìä Dados do Arquivo</h3>
                <div style="margin-bottom: 1rem;">
                    <label style="font-weight: 600; margin-right: 1rem;">Filtrar por Tipo de Registro:</label>
                    <select id="proceda-filter" style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--color-border);">
                        <option value="all">Todos os Registros</option>
                    </select>
                </div>
                <div id="proceda-table-container" style="overflow-x: auto; max-height: 600px; overflow-y: auto;">
                    </div>
                <div class="button-group">
                    <button id="proceda-export-csv" class="button-secondary">üì• Exportar CSV</button>
                    <button id="proceda-export-json" class="button-secondary">üì• Exportar JSON</button>
                    <button id="proceda-export-txt" class="button-secondary">üì• Exportar TXT</button>
                </div>
            </div>
                
            <div id="proceda-info" style="margin-top: 1.5rem; display: none;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                    <div style="padding: 1rem; background: var(--color-bg-secondary); border-radius: 8px; border-left: 4px solid var(--color-primary);">
                        <div style="font-size: 0.85rem; color: var(--color-text-muted);">Formato</div>
                        <div id="proceda-modelo" style="font-size: 1.2rem; font-weight: 600; margin-top: 0.25rem;">-</div>
                    </div>
                    <div style="padding: 1rem; background: var(--color-bg-secondary); border-radius: 8px; border-left: 4px solid var(--color-secondary);">
                        <div style="font-size: 0.85rem; color: var(--color-text-muted);">Vers√£o</div>
                        <div id="proceda-versao" style="font-size: 1.2rem; font-weight: 600; margin-top: 0.25rem;">-</div>
                    </div>
                    <div style="padding: 1rem; background: var(--color-bg-secondary); border-radius: 8px; border-left: 4px solid var(--color-success);">
                        <div style="font-size: 0.85rem; color: var(--color-text-muted);">Total de Registros</div>
                        <div id="proceda-linhas" style="font-size: 1.2rem; font-weight: 600; margin-top: 0.25rem;">-</div>
                    </div>
                    <div style="padding: 1rem; background: var(--color-bg-secondary); border-radius: 8px; border-left: 4px solid var(--color-error);">
                        <div style="font-size: 0.85rem; color: var(--color-text-muted);">Status</div>
                        <div id="proceda-status" style="font-size: 1.2rem; font-weight: 600; margin-top: 0.25rem;">-</div>
                    </div>
                </div>
            </div>
            
            <div id="proceda-errors" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--color-error-bg); border: 1px solid var(--color-error); border-radius: 8px;">
                <h4 style="color: var(--color-error); margin-bottom: 0.5rem;">‚ö†Ô∏è Erros Encontrados:</h4>
                <ul id="proceda-error-list" style="margin: 0; padding-left: 1.5rem; color: #dc2626;"></ul>
            </div>
            
            <div id="proceda-warnings" style="display: none; margin-top: 1rem; padding: 1rem; background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px;">
                <h4 style="color: #d97706; margin-bottom: 0.5rem;">‚ö†Ô∏è Avisos:</h4>
                <ul id="proceda-warning-list" style="margin: 0; padding-left: 1.5rem; color: #d97706;"></ul>
            </div>
        </section>

        </main>

    <div id="edi-settings-modal" class="modal-backdrop" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin: 0;">Configura√ß√µes de Layout EDI</h2>
                <button id="close-edi-settings-modal" class="modal-close-button">&times;</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--color-text-muted); margin-bottom: 1.5rem; font-size: 0.95rem;">
                    Aqui voc√™ pode personalizar as posi√ß√µes de in√≠cio (<b>Pos</b>) e o tamanho (<b>Tam</b>) de cada campo para os layouts de arquivo fixo.
                    As posi√ß√µes s√£o baseadas em 1 (o primeiro caractere √© a posi√ß√£o 1).<br>
                    Suas altera√ß√µes s√£o salvas automaticamente no seu navegador.
                </p>
                <div class="button-group" style="margin-bottom: 2rem;">
                    <button id="edi-save-layouts" class="button-primary">üíæ Salvar Altera√ß√µes</button>
                    <button id="edi-restore-layouts" class="button-secondary">üîÑ Restaurar Padr√µes</button>
                </div>
                
                <div class="edi-settings-tabs">
                    </div>
                
                <div id="edi-settings-forms" style="margin-top: 1.5rem;">
                    </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>

    <script src="utils.js"></script>
    
    <script src="validators.js"></script>
    
    <script src="zpl-nfe.js"></script>
    
    <script src="edi-layouts.js"></script>
    
    <script src="edi-logic.js"></script>

    <script src="nfe-batch-validator.js"></script>

    <script src="reports-logic.js"></script>
    
</body>
</html>